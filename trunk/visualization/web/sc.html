<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>dc.js common charts</title>

    <meta charset="UTF-8">

    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript" src="js/env-data.js"></script>

    <link rel="stylesheet" type="text/css" href="css/dc.css"/>

<style>
    body {
        font-size: 0.9em;
        font-family: Lucida;
    }

    a {
        color: #3182bd;
    }

    .clear {
        clear: both;
    }
</style>

</head>
<body>

<div><input type="button" value="Add Data" onclick="data.add(json2);alert('Data injected');dc.renderAll();"/></div>

<div id="bubble-overlay">
<span>Bubble Overlay</span>
<a class="reset" href="javascript:bubbleOverlay.filterAll();dc.redrawAll();" style="display: none;">reset</a>
<span class="reset" style="display: none;"><span class="filter"></span></span>



<div class="clear"></div>

<div id="pie-chart-value">
    <span>Value DonutChart</span>
    <a class="reset" href="javascript:pieChartValue.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;"><span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="pie-chart-country">
    <span>Country PieChart</span>
    <a class="reset" href="javascript:pieChartCountry.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;"><span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="choropleth-chart">
    <span>Choropleth Chart</span>
    <a class="reset" href="javascript:choroplethChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div class="clear"></div>

Country filter: <input id="custom-filter" type="text"/>
<button onclick="countryDimension.filter($('#custom-filter').val());dc.redrawAll();">go</button>

<div class="clear"></div>

<div id="line-chart-date">
    <span>Value LineChart</span>
    <a class="reset" href="javascript:lineChartDate.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="bar-chart-date">
    <span>Date BarChart (3 months)</span>
    <a class="reset" href="javascript:barChartDate.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="composite-chart-date">
    <span>Date Composite Chart (3 months)</span>
    <a class="reset" href="javascript:compositeChartDate.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div class="clear"></div>

<div id="line-chart-dateB">
    <span>Value LineChart in GroupB</span>
    <a class="reset" href="javascript:lineChartDateB.filterAll();dc.redrawAll('groupB');"
       style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="bar-chart-dateB">
    <span>Date BarChart (3 months) in GroupB</span>
    <a class="reset" href="javascript:barChartDateB.filterAll();dc.redrawAll('groupB');"
       style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="composite-chart-dateB">
    <span>Date Composite Chart (3 months) in GroupB</span>
    <a class="reset" href="javascript:compositeChartDateB.filterAll();dc.redrawAll('groupB');" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div class="clear"></div>

<div id="bar-chart-switch">
    <span>Bar Chart Runtime Switch</span>
    <a class="reset" href="javascript:barSwitchChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>
    <button onclick="barSwitchChart.group(dateNegativeValueSumGroup).redraw()">Switch</button>
    <button onclick="barSwitchChart.group(dateValueSumGroup).redraw()">Switch Back</button>
    <div class="clear"></div>
</div>

<div class="clear"></div>

<div id="bubble-chart">
    <span>Bubble Chart (Value, Count, Count)</span>
    <a class="reset" href="javascript:bubbleChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div class="clear"></div>

<div id="ordinal-bar-chart">
    <span>Ordinal Bar Chart</span>
    <a class="reset" href="javascript:ordinalBarChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="ordinal-line-chart">
    <span>Ordinal Line Chart</span>
    <a class="reset" href="javascript:ordinalLineChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="linear-bar-chart">
    <span>Linear Bar Chart</span>
    <a class="reset" href="javascript:linearBarChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div class="clear"></div>

<div id="negative-bar-chart">
    <span>Negative Bar Chart</span>
    <a class="reset" href="javascript:negativeBarChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div id="negative-line-chart">
    <span>Negative Line Chart</span>
    <a class="reset" href="javascript:negativeLineChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div class="clear"></div>

<div id="row-chart">
    <span>Row Chart</span>
    <a class="reset" href="javascript:rowChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div class="clear"></div>

<div id="scatterplot">
    <span>Scatter Plot</span>
    <a class="reset" href="javascript:scatterPlot.filterAll();dc.redrawAll();" style="display: none;">reset</a>
    <br/><span class="reset" style="display: none;">Current filter: <span class="filter"></span></span>

    <div class="clear"></div>
</div>

<div class="clear"></div>

<div class="dc-data-count">
    <span class="filter-count"></span> selected out of <span class="total-count"></span>
</div>

<div class="clear"></div>

<table class="dc-data-table">
    <thead>
    <tr>
        <td>ID</td>
        <td>Date</td>
        <td>Status</td>
        <td>Country</td>
        <td>Value</td>
    </tr>
    </thead>
</table>

<script type="text/javascript">
var pieChartValue = dc.pieChart("#pie-chart-value")
        .width(250)
        .height(250)
        .radius(100)
        .innerRadius(40)
        .dimension(valueDimension)
        .group(valueGroup);

var pieChartCountry = dc.pieChart("#pie-chart-country")
        .width(250)
        .height(250)
        .radius(100)
        .dimension(countryDimension)
        .group(countryGroup)
        .renderTitle(true);

var choroplethChart = dc.geoChoroplethChart("#choropleth-chart")
        .width(990)
        .height(600);

d3.json("geo/us-states.json", function (states) {
    d3.json("geo/us-counties.json", function (counties) {
        choroplethChart
                .dimension(stateDimension)
                .group(stateValueSumGroup)
                .colors(["#ccc", "#E2F2FF", "#C4E4FF", "#9ED2FF", "#81C5FF", "#6BBAFF", "#51AEFF", "#36A2FF", "#1E96FF", "#0089FF"])
                .colorDomain([0, 155])
                .overlayGeoJson(states.features, "state", function (d) {
                    return d.properties.name;
                })
                .overlayGeoJson(counties.features, "county")
                .title(function (d) {
                    return d.key + " : " + (d.value ? d.value : 0);
                });

        dc.renderAll();
    });
});

var lineChartDate = dc.lineChart("#line-chart-date");
lineChartDate.width(500)
        .height(180)
        .margins({top: 30, right: 50, bottom: 30, left: 30})
        .dimension(dateDimension)
        .group(dateIdSumGroup, "Id Sum")
        .stack(dateValueSumGroup, "Value Sum")
        .stack(dateIdSumGroup, "Fixed", function (d) {
            return 10;
        })
        .brushOn(false)
        .title(function (d) {
            return d.value;
        })
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 7, 15)]))
        .xUnits(d3.time.days)
        .elasticY(true)
        .renderArea(true)
        .legend(dc.legend().x(400).y(10).itemHeight(13).gap(5))
        .xAxis().ticks(5);

var barChartDate = dc.barChart("#bar-chart-date");
barChartDate.width(500)
        .height(180)
        .margins({top: 30, right: 50, bottom: 30, left: 30})
        .dimension(dateDimension)
        .group(dateIdSumGroup, "Id Sum")
        .stack(dateValueSumGroup, "Value Sum")
        .elasticY(true)
        .stack(dateFixedSumGroup, "Fixed", function (d) {
            return 10;
        })
        .gap(1)
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 7, 15)]))
        .legend(dc.legend().x(400).y(10).itemHeight(13).gap(5))
        .xUnits(d3.time.days)
        .xAxis().ticks(5);

var compositeChartDate = dc.compositeChart("#composite-chart-date");
compositeChartDate.width(500)
        .height(180)
        .margins({top: 30, right: 50, bottom: 30, left: 30})
        .dimension(dateDimension)
        .group(dateIdSumGroup, "Id Sum")
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 7, 15)]))
        .xUnits(d3.time.days)
        .shareColors(true)
        .compose([
            dc.barChart(compositeChartDate).group(dateValueSumGroup, "Value Sum"),
            dc.lineChart(compositeChartDate),
            dc.lineChart(compositeChartDate).group(dateGroup, "Date Group")
        ])
        .on('renderlet', function (chart) {
            dc.events.trigger(function () {
                barChartDate.focus(chart.filter());
                lineChartDate.focus(chart.filter());
            });
        })
        .legend(dc.legend().x(400).y(10).itemHeight(13).gap(5))
        .xAxis().ticks(5);

var bubbleChart = dc.bubbleChart("#bubble-chart");
bubbleChart.width(990)
        .height(150)
        .dimension(statusDimension)
        .group(statusMultiGroup)
        .colors(["#a60000", "#ff0000", "#ff4040", "#ff7373", "#67e667", "#39e639", "#00cc00"])
        .colorDomain([0, 220])
        .colorAccessor(function (p) {
            return p.value.value;
        })
        .keyAccessor(function (p) {
            return p.key;
        })
        .valueAccessor(function (p) {
            return p.value.count;
        })
        .radiusValueAccessor(function (p) {
            return p.value.count;
        })
        .x(d3.scale.ordinal().domain(["A", "T", "F", "Z"]))
        .xUnits(dc.units.ordinal)
        .y(d3.scale.linear().domain([0, 10]))
        .r(d3.scale.linear().domain([0, 30]))
        .maxBubbleRelativeSize(0.3)
        .elasticY(true)
        .yAxisPadding("50%")
        .elasticX(true)
        .xAxisPadding("10%")
        .renderLabel(true)
        .renderTitle(true)
        .title(function (p) {
            return p.key + ": {count:" + p.value.count + ",value:" + p.value.value + "}"
        });

var ordinalBarChart = dc.barChart("#ordinal-bar-chart");
ordinalBarChart.width(500)
        .height(150)
        .dimension(stateDimension)
        .group(stateGroup)
        .elasticY(true)
        .x(d3.scale.ordinal().domain(["California", "Colorado", "Delaware", "Mississippi", "Oklahoma", "Ontario"]))
        .xUnits(dc.units.ordinal);

var ordinalLineChart = dc.lineChart("#ordinal-line-chart");
ordinalLineChart.width(500)
        .height(150)
        .dimension(stateDimension)
        .group(stateGroup)
        .y(d3.scale.linear().domain([0, 3]))
        .renderArea(true)
        .renderTitle(true)
        .x(d3.scale.ordinal().domain(["California", "Colorado", "Delaware", "Mississippi", "Oklahoma", "Ontario"]))
        .xUnits(dc.units.ordinal);

var linearBarChart = dc.barChart("#linear-bar-chart");
linearBarChart.width(500)
        .height(150)
        .dimension(valueDimension)
        .group(valueGroup)
        .elasticY(true)
        .x(d3.scale.linear().domain([20, 70]))
        .xUnits(dc.units.fp.precision(1));

var barSwitchChart = dc.barChart("#bar-chart-switch");
barSwitchChart.width(500)
        .height(150)
        .dimension(dateDimension)
        .group(dateValueSumGroup)
        .gap(1)
        .renderHorizontalGridLines(true)
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 7, 15)]))
        .xUnits(d3.time.days)
        .elasticY(true)
        .xAxis().ticks(5);

var negativeBarChart = dc.barChart("#negative-bar-chart");
negativeBarChart.width(1100)
        .height(200)
        .margins({top: 30, right: 50, bottom: 30, left: 30})
        .dimension(dateDimension)
        .group(dateNegativeValueSumGroup)
        .stack(dateNegativeValueSumGroup)
        .stack(dateNegativeValueSumGroup)
        .yAxisPadding(5)
        .elasticY(true)
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 7, 15)]))
        .renderHorizontalGridLines(true)
        .xUnits(d3.time.days);

var negativeLineChart = dc.lineChart("#negative-line-chart");
negativeLineChart.width(1100)
        .height(200)
        .margins({top: 30, right: 50, bottom: 30, left: 30})
        .dimension(dateDimension)
        .group(dateNegativeValueSumGroup)
        .renderArea(true)
        .stack(dateNegativeValueSumGroup)
        .stack(dateNegativeValueSumGroup)
        .yAxisPadding(5)
        .elasticY(true)
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 7, 15)]))
        .renderHorizontalGridLines(true)
        .xUnits(d3.time.days);

var rowChart = dc.rowChart("#row-chart");
rowChart.width(1100)
        .height(200)
        .margins({top: 30, left: 10, right: 30, bottom: 30})
        .dimension(valueDimension)
        .group(valueGroup)
        .renderTitle(true)
        .renderLabel(true)
        .title(function (d) {
            return d.value;
        })
        .colors(d3.scale.category20b());

var scatterPlot = dc.scatterPlot("#scatterplot");
scatterPlot.width(500)
            .height(180)
            .dimension(dateDimension)
            .group(dateIdSumGroup)
            .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 7, 15)]))
            .symbolSize(2);


dc.dataCount(".dc-data-count")
        .dimension(data)
        .group(groupAll);

dc.dataTable(".dc-data-table")
        .dimension(dateDimension)
        .group(function (d) {
            return dateFormat(d3.time.day(d.dd));
        })
        .size(3)
        .sortBy(function (d) {
            return d.dd.getTime();
        })
        .columns([
            function (d) {
                return d.id;
            },
            function (d) {
                return d.date;
            },
            function (d) {
                return d.status;
            },
            function (d) {
                return d.countrycode;
            },
            function (d) {
                return d.value;
            }
        ]);

var lineChartDateB = dc.lineChart("#line-chart-dateB", "groupB");
lineChartDateB.width(500)
        .height(150)
        .margins({top: 50, right: 50, bottom: 30, left: 30})
        .dimension(dateDimension)
        .group(dateIdSumGroup)
        .stack(dateValueSumGroup)
        .stack(dateValueSumGroup, function (d) {
            return 10;
        })
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 07, 15)]))
        .xUnits(d3.time.days)
        .y(d3.scale.linear().domain([0, 200]))
        .elasticX(true)
        .xAxisPadding(50)
        .renderArea(true)
        .renderHorizontalGridLines(true)
        .xAxis().ticks(5);

var barChartDateB = dc.barChart("#bar-chart-dateB", "groupB");
barChartDateB.width(500)
        .height(150)
        .dimension(dateDimension)
        .group(dateIdSumGroup)
        .stack(dateValueSumGroup)
        .stack(dateValueSumGroup, function (d) {
            return 10;
        })
        .brushOn(false)
        .title(function (d) {
            return d.value;
        })
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 07, 15)]))
        .xUnits(d3.time.days)
        .renderHorizontalGridLines(true)
        .renderVerticalGridLines(true)
        .gap(0)
        .xAxis().tickValues([new Date(2012, 3, 1), new Date(2012, 6, 1), new Date(2012, 9, 1)]);
barChartDateB.yAxis().tickValues([0, 75, 140]);

var compositeChartDateB = dc.compositeChart("#composite-chart-dateB", "groupB");
compositeChartDateB.width(500)
        .height(150)
        .dimension(dateDimension)
        .group(dateIdSumGroup)
        .x(d3.time.scale().domain([new Date(2012, 4, 20), new Date(2012, 07, 15)]))
        .xUnits(d3.time.days)
        .renderVerticalGridLines(true)
        .compose([
            dc.barChart(compositeChartDateB).gap(0).group(dateValueSumGroup).title(function (d) {
                return "Bar key: " + d.key + "\nBar value: " + d.value;
            }),
            dc.lineChart(compositeChartDateB),
            dc.lineChart(compositeChartDateB).group(dateGroup)
        ])
        .brushOn(false)
        .on('renderlet', function (chart) {
            chart.selectAll("rect.bar").attr("width", function (d) {
                return Math.round(d.data.value / 10);
            });
        })
        .xAxis().ticks(5);

dc.renderAll("groupB");

var bubbleOverlay = dc.bubbleOverlay("#bubble-overlay")
        .svg(d3.select("#bubble-overlay svg"))
        .width(600)
        .height(450)
        .dimension(stateDimension)
        .group(stateValueSumGroup)
        .r(d3.scale.linear().domain([0, 300]))
        .title(function (d) {
            return "Title: " + d.key;
        })
        .point("California", 100, 120)
        .point("Colorado", 300, 120)
        .point("Delaware", 500, 220)
        .point("Ontario", 180, 90)
        .point("Mississippi", 120, 220)
        .point("Oklahoma", 200, 350);
</script>

<div class="clear"></div>

<div>
    <a href="javascript:dc.renderAll();">Render All</a>
    <a href="javascript:dc.filterAll(); dc.renderAll();">Filter All</a>
</div>

</body>
</html>
